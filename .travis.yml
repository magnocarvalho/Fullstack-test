language: node_js
sudo: required
services:
  - docker
cache:
   directories:
     - node_modules
node_js:
  - 10
before_install:
  - npm install -g node-gyp
before_script:
  - npm install
  - npm install -g standard
  - docker build -t magnos .
  - docker run -p 80:$PORT -d magnos
  - sleep 3
script:
  - docker info
  - npm run test
deploy:
  provider: heroku:git
  api_key:  64bdf5a4-099e-4311-b0c0-b5a5d064bfba
  edge: true # opt in to dpl v2
after_script:
  - docker kill